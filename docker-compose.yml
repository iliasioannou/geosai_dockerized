version: '2'
services:
  geoserver:
    image: kartoza/geoserver
    container_name: cmems_geoserver
    volumes:
      - ./shared_data/geoserver/geoserver_data_dir:/opt/geoserver/data_dir
      - ./shared_data:/shared
    expose:
      - 9090
  processors:
    image: planetek/cmems_processors:develop
    container_name: cmems_processors
    volumes:
      - ./shared_data/C5_OutputDir:/src/Processors/server/processors/C5_OutputDir
      - ./shared_data/C3_Input:/src/Processors/server/processors/C3_Input
    expose:
      - 9091
  postgres:
    image: postgres
    environment:
      - POSTGRES_PASSWORD=geonetwork
    container_name: cmems_postgres
    volumes:
      - ./shared_data/postgres/dump:/opt/data-volume
      - ./shared_data/postgres/data:/var/lib/postgresql/data
  geonetwork:
    image: geonetwork:postgres
    environment:
      - POSTGRES_DB_USERNAME=postgres
      - POSTGRES_DB_PASSWORD=geonetwork
    container_name: cmems_geonetwork
  esb:
    image: planetek/cmems_esb:develop
    container_name: cmems_esb
    volumes:
      - ./shared_data/geoserver/data:/root
      - ./shared_data/geoserver/geoserver_data_dir:/opt/geoserver/data_dir
      - ./shared_data:/shared
      - ./shared_data/.m2:/root/.m2
    expose:
      - 9190
  gui:
    image: planetek/cmems-gui:develop
    container_name: cmems_gui
    ports:
      - 80:8080
  mysql_activiti:
    image: mysql
    container_name: cmems_mysql_activiti
    environment:
      - MYSQL_ROOT_PASSWORD=cmems
      - MYSQL_DATABASE=cmems_activiti
      - MYSQL_USER=activiti
      - MYSQL_PASSWORD=pkz_029activiti
    volumes:
      - ./shared_data/mysql:/var/lib/mysql 
  activiti:
    container_name: cmems_activiti
    image: planetek/cmems_activiti:develop
    ports:
      - 9085:9085
    environment:
      - DB_TYPE=mysql  
      - DB_HOST=cmems_mysql_activiti
      - DB_NAME=cmems_activiti
      - DB_USER=activiti 
      - DB_PASS=pkz_029activiti
  nginx:
    container_name: cmems_nginx
    image: kyma/docker-nginx
    command: nginx
    volumes: 
      - ./shared_data/download:/var/www/download
  manager_od:
    container_name: cmems_manager_od
    image: planetek/cmems_manager_od:develop
    expose:
      - 8080
    volumes:
      - ./shared_data:/shared
  mysql_manager:
    image: mysql
    container_name: cmems_manager_mysql
    expose:
      - 3306
    environment:
      - MYSQL_DATABASE=cmems_manager
      - MYSQL_USER=cmems
      - MYSQL_PASSWORD=cmems
      - MYSQL_ROOT_PASSWORD=cmems
  postgres-cmems:
    image: postgres:9.6
    environment:
      - POSTGRES_USER=cmems
      - POSTGRES_PASSWORD=cmems
      - POSTGRES_DB=CMEMS_DB
    container_name: cmems_db_api
    volumes:
      - ./init_cmems.sql:/docker-entrypoint-initdb.d/init.sql
      - ./shared_data/postgres-cmems/data:/var/lib/postgresql/data
  api:
    image: planetek/cmems_api:develop
    container_name: cmems_api
  wordpress:
    container_name: cmems_wordpress
    image: wordpress
    ports:
      - 9999:80
    environment:
      - WORDPRESS_DB_PASSWORD=SFzDmSz43aU0xhJ
      - WORDPRESS_DB_USER=cmems
    volumes:
      - /home/dockermanager/pkz029_UU_CMEMS_dockerized/shared_data/wordpress_data:/var/www/html
  mysql:
    container_name: cmems_wordpress_mysql
    image: mariadb
    environment:
      - MYSQL_USER=cmems
      - MYSQL_PASSWORD=SFzDmSz43aU0xhJ
      - MYSQL_ROOT_PASSWORD=lubHiOgCnFsRCT7
      - MYSQL_DATABASE=wordpress
    volumes:
      - ./shared_data/mysql-wordpress:/var/lib/mysql
  portainer:
    container_name: cmems_portainer
    image: portainer/portainer
    volumes:
      -  /var/run/docker.sock:/var/run/docker.sock
    ports:
      -  9542:9000
  proxy:
    ports:
      - 80:80
    image: planetek/cmems_proxy:base
    container_name: cmems_proxy
  backup:
    image: aveltens/wordpress-backup
    restart: always
    volumes:
      - ./shared_data/backups:/backups
    volumes_from:
      - wordpress
    depends_on:
      - mysql
    environment:
      - MYSQL_ENV_MYSQL_DATABASE=wordpress
      - MYSQL_ENV_MYSQL_USER=cmems
      - MYSQL_ENV_MYSQL_PASSWORD=SFzDmSz43aU0xhJ
      - MYSQL_PORT_3306_TCP_PORT=3306
    container_name: cmems_wordpress_backup
networks:
  default:
    external:
      name: cmems
